<!DOCTYPE html>
<html>
	<head>
		<style>
			#container {
				margin: 0px auto;
				width: 500px;
				height: 375px;
				border: 10px #333 solid;
			}
			#videoElement {
				width: 500px;
				height: 375px;
				background-color: #666;
			}
		</style>
	</head>
	
	<body>
		<div id="container">
			<video autoplay="true" id="videoElement">
					
			</video>
		</div>
	
		<canvas id="graph" width="256" height="100">
				
		</canvas>
		
		<script>
			var video = document.querySelector("#videoElement");
			var dims;

			if (navigator.mediaDevices.getUserMedia) {
				navigator.mediaDevices.getUserMedia({video: true}).then(function (stream) {
					video.srcObject = stream;
					dims = stream.getVideoTracks()[0].getSettings();
				});
			}
			
			var canvas = document.createElement('canvas');
			canvas.width = 500;//dims.width;
			canvas.height = 375;//dims.height;
			var ctx = canvas.getContext('2d');
			
			var graph = document.querySelector("#graph").getContext('2d');
			graph.fillRect(0, 0, 256, 100);
			
			setInterval(function() {
				ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
				var data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
				var numPixels = data.length/4;
				var r = [];
				var g = [];
				var b = [];
				var a = [];
				for (var i = 0; i < 256; i++) {
					r[i] = 0;
					g[i] = 0;
					b[i] = 0;
					a[i] = 0;
				}
				for (var i = 0; i < data.length; i+=4) {
					r[data[i]]++;
					g[data[i+1]]++;
					b[data[i+2]]++;
					a[data[i+3]]++;
				}
				for (var i = 0; i < 256; i++) {
					r[i] /= numPixels;
					g[i] /= numPixels;
					b[i] /= numPixels;
					a[i] /= numPixels;
					
					graph.beginPath();
					graph.fillRect(i, 0, i, r[i]);
					graph.fillStyle = "red";
					graph.fill();
				}
				console.log(r);
			}, 1000);
			
		</script>
	</body>
</html>
